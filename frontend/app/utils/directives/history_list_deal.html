<div class="timeline-item-container">
    <div class="timeline-avatar" ng-if="vm.item.assigned_to" ng-style="{'background-image': 'url(' + vm.item.assigned_to.profile_picture + ')'}"></div>
    <div class="timeline-avatar" ng-if="!vm.item.assigned_to" style="background-image: url('vendor/metronic/assets/admin/layout4/img/avatar.png');"></div>

    <div class="timeline-content-container has-deal">
        <div class="timeline-content-header">
            <span class="timeline-content-title">
                <a ui-sref="base.deals.detail({ id: vm.item.id })">
                    {{ ::vm.item.name }} ({{ ::vm.item.archived ? 'archived' : vm.item.status.name}})
                </a>
            </span>
            <div class="timeline-date" title="Modified on {{ ::vm.item.modified | date:'dd MMM yyyy - HH:mm' }}">
                {{ ::vm.item.modified | date:'dd MMM yyyy - HH:mm' }}
            </div>
        </div>

        <div class="content-details history-item-body">
            <editable-textarea extra-class="detail-plain-text" view-model="vm" field="description" object="vm.item"></editable-textarea>
        </div>

        <div class="content-details-additional">
            <div class="content-history-divider"></div>

            <div class="content-history-container">
                <ul class="content-history-list">
                    <li ng-repeat="note in vm.item.notes">
                        <div class="content-history-note-header">
                            <div class="content-history-avatar" ng-style="{'background-image': 'url(' + note.author.profile_picture + ')'}"></div>
                            <div class="content-history-date">{{ ::note.modified | date:'dd MMM yyyy - HH:mm' }}</div>
                        </div>
                        <div class="content-history-note-body">
                            <editable-textarea view-model="vm" field="content" object="note"></editable-textarea>
                        </div>
                    </li>
                    <li>
                        <div class="content-history-note-header">
                            <div ng-if="vm.item.created_by" class="content-history-avatar" ng-style="{'background-image': 'url(' + vm.item.created_by.profile_picture + ')'}"></div>
                            <div ng-if="!vm.item.created_by" class="content-history-avatar" style="background-image: url('vendor/metronic/assets/admin/layout4/img/avatar.png');"></div>
                            <div class="content-history-desc">
                                {{ ::vm.item.created_by.full_name || 'An unknown entity' }} created the deal <a ui-sref="base.deals.detail({ id: vm.item.id })">{{ ::vm.item.name }}</a>
                            </div>

                            <div class="content-history-date">{{ ::vm.item.created | date:'dd MMM yyyy - HH:mm' }}</div>
                            <div class="clearfix"></div>
                        </div>
                    </li>
                </ul>
            </div>

            <div class="content-history-container add-note-inline">
                <ul class="content-history-list">
                    <li>
                        <div class="content-history-note-header">
                            <div class="content-history-avatar is-note">
                                <i class="lilicon hl-note-icon"></i>
                            </div>
                        </div>
                        <div class="content-history-note-body has-form">
                            <history-add-note item="vm.item"></history-add-note>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
