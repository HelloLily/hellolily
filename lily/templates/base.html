{% load i18n staticfiles %}

<!DOCTYPE html>
{% block html-tag %}<html lang="en" ng-app="app" ng-controller="BaseController">{% endblock html-tag %}
    <!-- BEGIN HEAD -->
    <head>
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="description" content="Lily CRM system" />
        <meta name="author" content="Devhouse Spindle" />

        {% block html-title %}<title ng-bind="settings.page.title + ' - Lily'">Lily</title>{% endblock html-title %}

        <!-- Generated using realfavicongenerator.net using the three base_images. -->
        <link rel="apple-touch-icon" sizes="57x57" href="{% static 'app/images/favicons/apple-touch-icon-57x57.png' %}">
        <link rel="apple-touch-icon" sizes="60x60" href="{% static 'app/images/favicons/apple-touch-icon-60x60.png' %}">
        <link rel="apple-touch-icon" sizes="72x72" href="{% static 'app/images/favicons/apple-touch-icon-72x72.png' %}">
        <link rel="apple-touch-icon" sizes="76x76" href="{% static 'app/images/favicons/apple-touch-icon-76x76.png' %}">
        <link rel="apple-touch-icon" sizes="114x114" href="{% static 'app/images/favicons/apple-touch-icon-114x114.png' %}">
        <link rel="apple-touch-icon" sizes="120x120" href="{% static 'app/images/favicons/apple-touch-icon-120x120.png' %}">
        <link rel="apple-touch-icon" sizes="144x144" href="{% static 'app/images/favicons/apple-touch-icon-144x144.png' %}">
        <link rel="apple-touch-icon" sizes="152x152" href="{% static 'app/images/favicons/apple-touch-icon-152x152.png' %}">
        <link rel="apple-touch-icon" sizes="180x180" href="{% static 'app/images/favicons/apple-touch-icon-180x180.png' %}">
        <link rel="icon" type="image/png" href="{% static 'app/images/favicons/favicon-32x32.png' %}" sizes="32x32">
        <link rel="icon" type="image/png" href="{% static 'app/images/favicons/android-chrome-192x192.png' %}" sizes="192x192">
        <link rel="icon" type="image/png" href="{% static 'app/images/favicons/favicon-96x96.png' %}" sizes="96x96">
        <link rel="icon" type="image/png" href="{% static 'app/images/favicons/favicon-16x16.png' %}" sizes="16x16">
        <link rel="manifest" href="{% static 'app/images/favicons/manifest.json' %}">
        <link rel="mask-icon" href="{% static 'app/images/favicons/safari-pinned-tab.svg' %}" color="#5bbad5">
        <link rel="shortcut icon" href="{% static 'app/images/favicons/favicon.ico' %}">
        <meta name="apple-mobile-web-app-title" content="Lily">
        <meta name="application-name" content="Lily">
        <meta name="msapplication-TileColor" content="#27244c">
        <meta name="msapplication-TileImage" content="{% static 'app/images/favicons/mstile-144x144.png' %}">
        <meta name="msapplication-config" content="{% static 'app/images/favicons/browserconfig.xml' %}">
        <meta name="theme-color" content="#fff">

        <!-- BEGIN GLOBAL MANDATORY STYLES -->
        <link href="{% static 'vendor/vendor.css' %}" rel="stylesheet" type="text/css">
        <link href="{% static 'app/app.css' %}" rel="stylesheet" type="text/css">
        <!-- END GLOBAL STYLES -->
    </head>
    <!-- END HEAD -->
    <!-- BEGIN BODY -->
    <!-- DOC: Apply "page-header-fixed-mobile" and "page-footer-fixed-mobile" class to body element to force fixed header or footer in mobile devices -->
    <!-- DOC: Apply "page-sidebar-closed" class to the body and "page-sidebar-menu-closed" class to the sidebar menu element to hide the sidebar by default -->
    <!-- DOC: Apply "page-sidebar-hide" class to the body to make the sidebar completely hidden on toggle -->
    <!-- DOC: Apply "page-sidebar-closed-hide-logo" class to the body element to make the logo hidden on sidebar toggle -->
    <!-- DOC: Apply "page-sidebar-hide" class to body element to completely hide the sidebar on sidebar toggle -->
    <!-- DOC: Apply "page-sidebar-fixed" class to have fixed sidebar -->
    <!-- DOC: Apply "page-footer-fixed" class to the body element to have fixed footer -->
    <!-- DOC: Apply "page-sidebar-reversed" class to put the sidebar on the right side -->
    <!-- DOC: Apply "page-full-width" class to the body element to have full width page without the sidebar menu -->
    {% block html-body %}
        <body class="page-header-fixed page-sidebar-closed-hide-logo page-container-bg-solid page-sidebar-closed-hide-logo page-on-load page-sidebar-fixed">
    {% endblock html-body %}

        {% block page-spinner %}
            <div ng-spinner-bar class="page-spinner-bar">
                <div class="bounce1"></div>
                <div class="bounce2"></div>
                <div class="bounce3"></div>
            </div>
        {% endblock page-spinner %}

        {% block page-header %}
            <page-header ng-if="settings.currentUser" class="page-header navbar navbar-fixed-top"></page-header>
        {% endblock page-header %}

        <div class="clearfix"></div>

        <!-- BEGIN CONTAINER -->
        <div class="page-container">
            <!-- BEGIN CONTENT -->
            <div class="page-content-wrapper">
                <div class="page-content">
                    {% block page-content %}
                    {% verbatim %}

                    <!-- BEGIN PAGE HEAD -->
                    <div class="page-head">
                        <!-- BEGIN PAGE TITLE -->
                        <div ng-if="toolbar" class="page-toolbar">
                            <div class="btn-group btn-theme-panel">
                                <a ng-click="$state.go('.edit')" class="btn" title="Edit"><i class="lilicon hl-edit-icon font-size-18"></i></a>
                                <toggle-activation-contact ng-if="toolbar.model === 'Contact'" model="{{ toolbar.model }}" object="toolbar.object" display-field="Toggle activation" button-class="no-background" icon-class="lilicon hl-company-icon font-size-18"></toggle-activation-contact>
                                <delete-confirmation model="{{ toolbar.model }}" object="toolbar.object" display-field="{{ toolbar.field }}" button-class="no-background" icon-class="lilicon hl-trashcan-icon font-size-18"></delete-confirmation>
                            </div>
                        </div>
                        <!-- END PAGE TITLE -->
                    </div>
                    <!-- END PAGE HEAD -->

                    <!-- BEGIN PAGE CONTENT-->
                    <div class="row">
                        <div class="col-md-12">
                            <div ui-view></div>
                        </div>
                    </div>
                    <!-- END PAGE CONTENT -->

                    {% endverbatim %}
                    {% endblock page-content %}
                </div>
            </div>
            <!-- END CONTENT -->
        </div>
        <!-- END CONTAINER -->

        <!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
        <script type="text/javascript" src="{% static 'vendor/vendor.js' %}" charset="utf-8"></script>
        <script type="text/javascript" src="{% static 'app/analytics.js' %}" charset="utf-8"></script>

        {% block page-scripts %}
            <script type="text/javascript" src="{% static 'app/templates.js' %}" charset="utf-8"></script>
            <script type="text/javascript" src="{% static 'app/app.js' %}" charset="utf-8"></script>
            <script type="text/javascript" src="{% static 'app/app-react.js' %}" charset="utf-8"></script>
            <script type="text/javascript">(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',intercomSettings);}else{var d=document;var i=function(){i.c(arguments)};i.q=[];i.c=function(args){i.q.push(args)};w.Intercom=i;function l(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/{{ INTERCOM_APP_ID }}';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);}if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})()
            </script>
            <script src="https://s3.amazonaws.com/pd-js-sdk/0.2.12/pandadoc-js-sdk.min.js"></script>
            <script type="text/javascript" src="https://js.chargebee.com/v1/chargebee.js"></script>
            <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/froala-editor/2.7.6/js/froala_editor.pkgd.min.js"></script>
            <script type="text/javascript">
                !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t,e){var n=document.createElement("script");n.type="text/javascript";n.async=!0;n.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(n,o);analytics._loadOptions=e};analytics.SNIPPET_VERSION="4.1.0";
                analytics.load('{{ SEGMENT_JS_SOURCE_WRITE_KEY }}');
                }}();

                // Identify the user in Segment on every page load.
                analytics.identify('{{ user.id }}', {
                    name: '{{ user.full_name }}',
                    email: '{{ user.email }}',
                    tenant_id: '{{ user.tenant.id }}',
                    tenant_name: '{{ user.tenant.name }}',
                    plan_tier: '{{ user.tenant.billing.plan.tier }}',
                    is_free_plan: '{{ user.tenant.billing.is_free_plan }}' == 'True',
                });
            </script>
            <script>
                // If billing is disabled we just set the tier to some high number so all features are available.
                const PLAN_HIGHEST_TIER = 99;

                var currentUser = {
                    id: parseInt('{{ user.id }}'),
                    firstName: '{{ user.first_name }}',
                    lastName: '{{ user.last_name }}',
                    picture: '{{ user.profile_picture|safe }}',
                    email: '{{ user.email }}',
                    internalNumber: parseInt('{{ user.internal_number }}') || false,
                    fullName: '{{ user.full_name }}',
                    isAdmin: '{{ user.is_admin }}' == 'True',
                    displayEmailWarning: '{{ user.display_email_warning }}' == 'True',
                    country: '{{ user.tenant.country }}',
                    company: '{{ user.tenant.name }}',
                    tenant: {
                        id: '{{ user.tenant.id }}',
                        planTier: '{{ user.tenant.billing.plan.tier }}' || PLAN_HIGHEST_TIER,
                        isFreePlan: '{{ user.tenant.billing.is_free_plan }}' == 'True',
                        accountAdmin: '{{ account_admin }}',
                        trialRemaining: parseInt('{{ user.tenant.billing.trial_remaining }}'),
                    },
                    timeLogging: {
                        enabled: '{{ user.tenant.timelogging_enabled }}' == 'True',
                        billingDefault: '{{ user.tenant.billing_default }}' == 'True',
                    },
                    user_hash: '{{ user.user_hash }}',
                    limitReached: {
                        accounts: '{{ limit_reached.accounts }}' == 'True',
                        contacts: '{{ limit_reached.contacts }}' == 'True',
                        emailAccounts: '{{ limit_reached.email_accounts }}' == 'True',
                    } || null,
                    primaryEmailAccount: parseInt('{{ user.primary_email_account.id }}') || null,
                    objectCounts: {
                        cases: parseInt('{{ object_counts.cases }}'),
                        deals: parseInt('{{ object_counts.deals }}'),
                    }
                };

                window.billingEnabled = '{{ BILLING_ENABLED }}' == 'True';
                window.intercomAppId = '{{ INTERCOM_APP_ID }}';
                window.sentryPublicDsn = '{{ SENTRY_FRONTEND_PUBLIC_DSN }}';
                window.slackClientId = '{{ SLACK_LILY_CLIENT_ID }}';
                window.segmentWriteKey = '{{ SEGMENT_JS_SOURCE_WRITE_KEY }}';
                window.debug = '{{ DEBUG }}' == 'True';
            </script>
        {% endblock page-scripts %}
        <!-- END JAVASCRIPTS -->
    </body>
    <!-- END BODY -->
</html>
