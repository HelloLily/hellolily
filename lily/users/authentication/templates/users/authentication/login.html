{% extends 'users/users_base.html' %}
{% load static two_factor %}

{% block title %}Lily | Login{% endblock title%}

{% block right-panel %}
    <div class="social-login">
        <a href="{% url 'social_login' provider_name='google' %}" class="google" role="button">
            <span class="image">
                <img src="{% static 'users/images/btn_google.svg' %}">
            </span>
            <span class="text">Log in with Google</span>
        </a>
        <div class="spacer-20"></div>
        <a href="{% url 'social_login' provider_name='microsoft' %}" class="microsoft" role="button">
            <span class="image">
                <img src="{% static 'users/images/btn_microsoft.svg' %}">
            </span>
            <span class="text">Log in with Microsoft</span>
        </a>
    </div>
    <div class="spacer-40"></div>
    <hr class="social-divider">
    <div class="spacer-40"></div>

    {% if wizard.steps.current == 'token' %}
        {% if device.method == 'call' %}
            <p>We are calling your phone right now, please enter the digits you hear.</p>
        {% elif device.method == 'sms' %}
            <p>We sent you a text message, please enter the tokens we sent.</p>
        {% else %}
            <p>Please enter the tokens generated by your token generator.</p>
        {% endif %}
    {% elif wizard.steps.current == 'backup' %}
        <p>
            Use this form for entering backup tokens for logging in.
            These tokens have been generated for you to print and keep safe. Please
            enter one of these backup tokens to login to your account.
        </p>
    {% endif %}

    <form action="" method="post" class="login-form" novalidate>
        {% csrf_token %}

        {{ wizard.management_form }}

        {% include 'users/_form_fields.html' with form=wizard.form %}

        {% if wizard.steps.current == 'auth' %}
            <div class="forgot-password">
                <a class="faded" href="{% url 'password_reset' %}" id="reset_password">
                    Forgot your password?
                </a>
            </div>
            <div class="spacer-40"></div>
        {% endif %}

        {% include 'users/authentication/_wizard_actions.html' %}

        {% if other_devices or backup_tokens %}
            <div class="spacer-20"></div>
        {% endif %}

        {% if other_devices %}
            {% for other in other_devices %}
                <div class="align-center">
                    <button name="challenge_device" type="submit" value="{{ other.persistent_id }}" class="link">
                        {{ other|device_action }}
                    </button>
                </div>
            {% endfor %}
        {% endif %}

        {% if backup_tokens %}
            <div class="align-center">
                <button name="wizard_goto_step" type="submit" value="backup" class="link">
                    Use Backup Token
                </button>
            </div>
        {% endif %}
    </form>

    {% if wizard.steps.current == 'auth' %}
        <div class="spacer-20"></div>
        <div class="align-center faded disclaimer">
            <p>
                Don't have an account yet?
            </p>
            <p>
                <a href="{% url 'register' %}" class="faded">Sign up.</a>
            </p>
        </div>
    {% endif %}
{% endblock right-panel %}
